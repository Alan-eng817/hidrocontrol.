<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HidroControl - Gest√£o Industrial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SDKs do Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, onSnapshot, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        window.FB_CORE = { initializeApp, getFirestore, collection, addDoc, serverTimestamp, query, onSnapshot, getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, doc, getDoc };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .tag-dropdown { animation: slideDown 0.2s ease-out; z-index: 100; }
        .success-overlay { animation: fadeIn 0.4s ease-out forwards; backdrop-filter: blur(10px); }
        
        .glass-dark { background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); }
        .glass-light { background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(0, 0, 0, 0.05); backdrop-filter: blur(12px); }

        /* Cores solicitadas pelo Alan */
        .text-limpos { color: #22c55e !important; }     /* Verde */
        .text-obstruidos { color: #facc15 !important; }  /* Amarelo */
        .text-ferro { color: #ef4444 !important; }      /* Vermelho */
        .border-ferro { border-color: rgba(239, 68, 68, 0.3) !important; }
    </style>
</head>
<body class="overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ‚úÖ CONFIGURA√á√ÉO FIREBASE ALAN (ID: hidrocontrol-4c13c)
        const CONFIG_MANUAL_FIREBASE = {
            apiKey: "AIzaSyCRXxxv_1e-QXC_vCXM5XHx65Zi_1PWQAw",
            authDomain: "hidrocontrol-4c13c.firebaseapp.com",
            projectId: "hidrocontrol-4c13c",
            storageBucket: "hidrocontrol-4c13c.firebasestorage.app",
            messagingSenderId: "260764839228",
            appId: "1:260764839228:web:340ab3fe2ea7675030c239"
        };

        // üîê CONFIGURA√á√ÉO DE ADMIN (S√ì ESTE E-MAIL BAIXA O EXCEL)
        const ADMIN_EMAIL = "alanlindoso1@gmail.com"; 

        // √çcones SVG
        const IconClipboard = () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>;
        const IconSave = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const IconChart = () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconLogOut = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x1="12" y2="12" y2="12"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>;

        const App = () => {
            const [user, setUser] = useState(null);
            const [auth, setAuth] = useState(null);
            const [db, setDb] = useState(null);
            const [view, setView] = useState('form'); 
            const [theme, setTheme] = useState('dark');
            const [historyData, setHistoryData] = useState([]);
            const [saveSuccess, setSaveSuccess] = useState(false);
            const [isSaving, setIsSaving] = useState(false);
            const [activeDropdownIndex, setActiveDropdownIndex] = useState(null);
            const [syncStatus, setSyncStatus] = useState('A conectar...');
            const [loginData, setLoginData] = useState({ email: '', password: '' });
            const chartRef = useRef(null);
            
            const appId = 'hidrocontrol-alumar-v1';

            const [items, setItems] = useState([{ 
                equipamento: '', tubosLimpos: '', tubosObstruidos: '', tubosComFerro: '', impactos: '', observacoes: ''
            }]);

            const [globalInfo, setGlobalInfo] = useState({
                data: new Date().toLocaleDateString('pt-BR'),
                empresa: 'Montisol',
                turno: 'ADM'
            });

            const equipamentosLista = [
                '025A-TC-21A','025A-TC-21B','025A-TC-21C','025A-TC-21D','025A-TC-21E','025A-TC-21F',
                '030-TC-001','030-TC-002','030-TC-003','030-TC-004','030-TC-005','030-TC-010',
                '030-TC-11A','030-TC-11B','030-TC-22A','030-TC-22B','030-TC-24A','030-TC-24B',
                '040-TC-011','042-TC-011','042-TC-016','042-TC-017','042-TC-018','042-TC-019',
                '042-TC-021','042-TC-026','042-TC-027','042-TC-028','042-TC-029',
                '042-TC-031','042-TC-036','042-TC-037','042-TC-038','042-TC-039','030-VA-16'
            ].sort();

            useEffect(() => {
                const initialize = async () => {
                    let count = 0;
                    while (!window.FB_CORE && count < 50) {
                        await new Promise(r => setTimeout(r, 100));
                        count++;
                    }
                    if (!window.FB_CORE) return;
                    const { initializeApp, getFirestore, getAuth, onAuthStateChanged } = window.FB_CORE;
                    try {
                        const appInstance = initializeApp(CONFIG_MANUAL_FIREBASE);
                        const authInstance = getAuth(appInstance);
                        setAuth(authInstance);
                        setDb(getFirestore(appInstance));
                        
                        onAuthStateChanged(authInstance, (u) => { 
                            if (u) { setUser(u); setSyncStatus('ONLINE'); }
                            else { setUser(null); setSyncStatus('LOGIN REQUERIDO'); }
                        });
                    } catch (e) { setSyncStatus('ERRO DE CONFIG'); }
                };
                initialize();
            }, []);

            useEffect(() => {
                if (!user || !db || !window.FB_CORE) return;
                const { collection, onSnapshot } = window.FB_CORE;
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'relatorios');
                const unsubscribe = onSnapshot(colRef, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => (b.localTimestamp || 0) - (a.localTimestamp || 0));
                    setHistoryData(data);
                }, (err) => setSyncStatus('ERRO DE PERMISS√ÉO'));
                return () => unsubscribe();
            }, [user, db]);

            useEffect(() => {
                if (view === 'dashboard' && historyData.length > 0) {
                    const ctx = document.getElementById('pieChart');
                    if (!ctx) return;
                    const totals = historyData.reduce((acc, rel) => {
                        (rel.items || []).forEach(it => {
                            acc.limpos += Number(it.tubosLimpos || 0);
                            acc.obstruidos += Number(it.tubosObstruidos || 0);
                            acc.ferro += Number(it.tubosComFerro || 0);
                        });
                        return acc;
                    }, { limpos: 0, obstruidos: 0, ferro: 0 });
                    if (chartRef.current) chartRef.current.destroy();
                    chartRef.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Limpos', 'Obstru√≠dos', 'Ferro'],
                            datasets: [{
                                data: [totals.limpos, totals.obstruidos, totals.ferro],
                                backgroundColor: ['#22c55e', '#facc15', '#ef4444'],
                                borderWidth: 0
                            }]
                        },
                        options: { plugins: { legend: { position: 'bottom', labels: { color: theme === 'dark' ? '#fff' : '#000' } } } }
                    });
                }
            }, [view, historyData, theme]);

            const handleLogin = async (e) => {
                e.preventDefault();
                if (!auth) return;
                const { signInWithEmailAndPassword, createUserWithEmailAndPassword } = window.FB_CORE;
                try {
                    await signInWithEmailAndPassword(auth, loginData.email, loginData.password);
                } catch (error) {
                    // Se o utilizador n√£o existir, cria a conta (l√≥gica de primeiro acesso)
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                        try {
                            await createUserWithEmailAndPassword(auth, loginData.email, loginData.password);
                        } catch (e2) { alert("Verifique a senha (m√≠n. 6 d√≠gitos) ou se o e-mail est√° correto."); }
                    } else {
                        alert("Erro no acesso: " + error.message);
                    }
                }
            };

            const handleLogout = () => { if (auth) window.FB_CORE.signOut(auth); };

            const updateItem = (idx, field, val) => {
                const newItems = [...items];
                newItems[idx] = { ...newItems[idx], [field]: val };
                setItems(newItems);
            };

            const removeItem = (idx) => {
                if (items.length > 1) setItems(items.filter((_, i) => i !== idx));
                else setItems([{ equipamento: '', tubosLimpos: '', tubosObstruidos: '', tubosComFerro: '', impactos: '', observacoes: '' }]);
            };

            const handleSave = async () => {
                if (!db || !user) return;
                setIsSaving(true);
                try {
                    const { collection, addDoc, serverTimestamp } = window.FB_CORE;
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'relatorios'), {
                        ...globalInfo,
                        items,
                        userEmail: user.email,
                        localTimestamp: Date.now(),
                        createdAt: serverTimestamp()
                    });
                    setSaveSuccess(true);
                    setTimeout(() => { 
                        setSaveSuccess(false); 
                        setView('dashboard'); 
                        setItems([{ equipamento: '', tubosLimpos: '', tubosObstruidos: '', tubosComFerro: '', impactos: '', observacoes: '' }]); 
                    }, 2000);
                } catch (e) { alert("Erro ao gravar dados na nuvem."); } finally { setIsSaving(false); }
            };

            const handleWhatsApp = () => {
                let msg = `*RELAT√ìRIO HIDROJATO - ${globalInfo.empresa.toUpperCase()}*%0AüìÖ ${globalInfo.data}%0Aüïí ${globalInfo.turno}%0A%0A`;
                items.forEach((it, i) => {
                    msg += `*${i+1}. TAG: ${it.equipamento}*%0A‚úÖ Limpos: ${it.tubosLimpos || 0}%0A‚ùå Obs: ${it.tubosObstruidos || 0}%0A‚ö†Ô∏è Ferro: ${it.tubosComFerro || 0}%0A`;
                    if (it.impactos) msg += `üí• Impactos: ${it.impactos}%0A`;
                    msg += `%0A`;
                });
                window.open(`https://wa.me/?text=${msg}`, '_blank');
            };

            const exportToExcel = () => {
                if (user?.email !== ADMIN_EMAIL) return;
                let csv = 'Data,Empresa,Equipamento,Limpos,Obstruidos,Ferro,Impactos,Observacoes\n';
                historyData.forEach(rel => (rel.items || []).forEach(it => {
                    csv += `"${rel.data}","${rel.empresa}","${it.equipamento}","${it.tubosLimpos}","${it.tubosObstruidos}","${it.tubosComFerro}","${(it.impactos || '').replace(/"/g, '""')}","${(it.observacoes || '').replace(/"/g, '""')}"\n`;
                }));
                const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `HidroControl_Industrial_${new Date().toLocaleDateString()}.csv`;
                link.click();
            };

            const bgClass = theme === 'dark' ? 'bg-slate-950 text-white' : 'bg-slate-50 text-slate-900';
            const cardClass = theme === 'dark' ? 'glass-dark' : 'glass-light';
            const inputBaseClass = theme === 'dark' ? 'bg-slate-900 border-slate-800 text-white' : 'bg-white border-slate-200 text-black';

            if (!user) {
                return (
                    <div className={`min-h-screen flex items-center justify-center p-6 ${bgClass}`}>
                        <div className={`${cardClass} w-full max-w-sm p-10 rounded-[3.5rem] shadow-2xl text-center space-y-8 animate-in zoom-in duration-500`}>
                            <div className="bg-blue-600/20 w-24 h-24 rounded-full flex items-center justify-center mx-auto text-blue-400">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            </div>
                            <div>
                                <h1 className="font-black text-3xl tracking-tighter uppercase">HIDRO<span className="text-blue-400">CONTROL</span></h1>
                                <p className="text-[10px] font-bold opacity-40 uppercase tracking-widest mt-2">Plataforma Industrial de Produ√ß√£o</p>
                            </div>
                            <form onSubmit={handleLogin} className="space-y-4 text-left">
                                <input type="email" placeholder="Seu E-mail" value={loginData.email} onChange={(e) => setLoginData({...loginData, email: e.target.value})} className={`w-full p-4 rounded-2xl outline-none font-bold text-sm border ${inputBaseClass}`} required />
                                <input type="password" placeholder="Senha" value={loginData.password} onChange={(e) => setLoginData({...loginData, password: e.target.value})} className={`w-full p-4 rounded-2xl outline-none font-bold text-sm border ${inputBaseClass}`} required />
                                <button type="submit" className="w-full bg-blue-600 hover:bg-blue-500 text-white py-5 rounded-2xl font-black uppercase text-xs shadow-xl transition-all active:scale-95">Entrar no Sistema</button>
                            </form>
                            <p className="text-[9px] text-slate-500 font-bold uppercase tracking-widest leading-relaxed">
                                Primeiro acesso? Digite o e-mail e crie sua senha agora.
                            </p>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen flex flex-col max-w-lg mx-auto relative transition-colors duration-300 ${bgClass}`}>
                    
                    {/* Header Premium */}
                    <header className={`p-6 sticky top-0 z-40 shadow-2xl flex items-center justify-between rounded-b-[2.5rem] border-b ${theme === 'dark' ? 'bg-slate-900/80 border-white/5' : 'bg-blue-600 border-blue-400/20 text-white'}`}>
                        <div className="flex items-center gap-3"><IconClipboard /><h1 className="font-black text-xl tracking-tighter uppercase">Hidro<span className="text-blue-400">Control</span></h1></div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="p-2.5 rounded-xl bg-white/10 active:scale-90 transition-all">{theme === 'dark' ? '‚òÄÔ∏è' : 'üåô'}</button>
                            <button onClick={handleLogout} title="Sair" className="p-2.5 rounded-xl bg-red-500/20 text-red-400 active:scale-90 transition-all"><IconLogOut /></button>
                        </div>
                    </header>

                    <main className="flex-grow p-5 space-y-6 overflow-y-auto hide-scroll pb-32">
                        {view === 'form' ? (
                            <div className="space-y-6 animate-in slide-in-from-bottom duration-500">
                                <div className="grid grid-cols-2 gap-3">
                                    {['Montisol', 'Constec'].map(e => (
                                        <button key={e} onClick={() => setGlobalInfo({...globalInfo, empresa: e})} className={`py-3.5 rounded-2xl font-black text-[10px] uppercase border-2 transition-all ${globalInfo.empresa === e ? 'bg-indigo-600 border-indigo-400 text-white shadow-lg scale-105' : theme === 'dark' ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-white border-slate-200 text-slate-400'}`}>{e}</button>
                                    ))}
                                </div>

                                {items.map((it, idx) => (
                                    <div key={idx} className={`${cardClass} p-6 space-y-6 border-l-8 border-l-blue-500 shadow-xl relative overflow-hidden`}>
                                        <button onClick={() => removeItem(idx)} className="absolute top-4 right-4 p-2 text-red-500/40 hover:text-red-500 active:scale-90"><IconTrash /></button>
                                        
                                        <div>
                                            <label className="text-[10px] font-black uppercase mb-2 block tracking-widest">Equipamento (TAG)</label>
                                            <input type="text" placeholder="Pesquisar TAG..." value={it.equipamento} onFocus={() => setActiveDropdownIndex(idx)} onChange={(e) => updateItem(idx, 'equipamento', e.target.value.toUpperCase())} className={`w-full p-4 rounded-2xl outline-none font-black text-sm border ${inputBaseClass}`} />
                                            {activeDropdownIndex === idx && (
                                                <div className={`absolute z-50 left-0 right-0 mt-2 rounded-2xl shadow-2xl border max-h-40 overflow-y-auto ${theme === 'dark' ? 'bg-slate-800 border-white/10' : 'bg-white border-slate-200'}`}>
                                                    {equipamentosLista.filter(tag => tag.includes(it.equipamento)).map(tag => (
                                                        <div key={tag} onClick={() => { updateItem(idx, 'equipamento', tag); setActiveDropdownIndex(null); }} className={`px-5 py-3 border-b border-white/5 font-black text-xs hover:bg-blue-500/10 cursor-pointer ${theme === 'dark' ? 'text-white' : 'text-black'}`}>{tag}</div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>

                                        <div className="grid grid-cols-3 gap-3">
                                            <div className="flex flex-col gap-1 text-center">
                                                <label className="text-[9px] font-black text-limpos uppercase">Limpos</label>
                                                <input type="number" value={it.tubosLimpos} onChange={(e) => updateItem(idx, 'tubosLimpos', e.target.value)} placeholder="0" className={`w-full p-4 rounded-2xl text-center font-black border border-green-500/20 text-limpos ${theme === 'dark' ? 'bg-slate-900' : 'bg-white'}`} />
                                            </div>
                                            <div className="flex flex-col gap-1 text-center">
                                                <label className="text-[9px] font-black text-obstruidos uppercase">Obs.</label>
                                                <input type="number" value={it.tubosObstruidos} onChange={(e) => updateItem(idx, 'tubosObstruidos', e.target.value)} placeholder="0" className={`w-full p-4 rounded-2xl text-center font-black border border-yellow-500/20 text-obstruidos ${theme === 'dark' ? 'bg-slate-900' : 'bg-white'}`} />
                                            </div>
                                            <div className="flex flex-col gap-1 text-center">
                                                <label className="text-[9px] font-black text-ferro uppercase">Ferro</label>
                                                <input type="number" value={it.tubosComFerro} onChange={(e) => updateItem(idx, 'tubosComFerro', e.target.value)} placeholder="0" className={`w-full p-4 rounded-2xl text-center font-black border border-red-500/20 text-ferro ${theme === 'dark' ? 'bg-slate-900' : 'bg-white'}`} />
                                            </div>
                                        </div>

                                        <textarea value={it.impactos} onChange={(e) => updateItem(idx, 'impactos', e.target.value)} placeholder="RELATE IMPACTOS ENCONTRADOS..." className={`w-full p-4 rounded-2xl outline-none text-xs h-20 border resize-none ${inputBaseClass}`} />
                                        <textarea value={it.observacoes} onChange={(e) => updateItem(idx, 'observacoes', e.target.value)} placeholder="OBSERVA√á√ïES ADICIONAIS..." className={`w-full p-4 rounded-2xl outline-none text-xs h-20 border resize-none ${inputBaseClass}`} />
                                    </div>
                                ))}

                                <button onClick={() => setItems([...items, { equipamento: '', tubosLimpos: '', tubosObstruidos: '', tubosComFerro: '', impactos: '', observacoes: '' }])} className="w-full py-5 rounded-[2rem] border-2 border-dashed border-slate-800 text-indigo-400 font-black text-[10px] uppercase flex items-center justify-center gap-2 active:scale-95 transition-all">+ Adicionar TAG</button>
                                
                                <button onClick={() => setView('preview')} className="w-full bg-blue-600 text-white py-6 rounded-3xl font-black uppercase text-xs shadow-xl active:scale-95 transition-all tracking-[0.25em]">Revisar Relat√≥rio</button>
                            </div>
                        ) : view === 'dashboard' ? (
                            <div className="space-y-6 animate-in fade-in duration-700 pb-10">
                                <div className="flex justify-between items-center px-2">
                                    <h2 className="text-[10px] font-black uppercase tracking-widest opacity-40">Painel de Produ√ß√£o</h2>
                                    {user?.email === ADMIN_EMAIL && (
                                        <button onClick={exportToExcel} className="p-3 bg-indigo-600/10 text-indigo-400 rounded-2xl flex items-center gap-2 text-[10px] font-black border border-indigo-500/20 active:scale-95 transition-all"><IconDownload /> EXCEL</button>
                                    )}
                                </div>
                                <div className={`${cardClass} p-10 flex flex-col items-center justify-center border-t-8 border-t-indigo-500 shadow-2xl`}>
                                    <div className="relative w-56 h-56 mb-6"><canvas id="pieChart"></canvas></div>
                                    <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1 text-center">Produ√ß√£o Total (Tubos)</p>
                                    <h3 className="text-6xl font-black tracking-tighter">{historyData.reduce((acc, rel) => acc + (rel.items || []).reduce((a, i) => a + Number(i.tubosLimpos), 0), 0)}</h3>
                                </div>
                                <div className="space-y-3">
                                    <p className="text-[10px] font-black uppercase tracking-[0.4em] px-4 opacity-30 text-center">Registos na Nuvem</p>
                                    {historyData.slice(0, 5).map(rel => (
                                        <div key={rel.id} className={`${cardClass} p-4 flex items-center justify-between border-l-4 border-l-indigo-500`}>
                                            <div className="text-xs font-black">{rel.data} ‚Ä¢ {rel.empresa}</div>
                                            <div className="text-green-500 font-black">+{ (rel.items || []).reduce((a,i) => a + Number(i.tubosLimpos), 0) }</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-8 pt-4">
                                <div className={`${theme === 'dark' ? 'bg-[#0a0a0c]' : 'bg-slate-800'} p-8 rounded-[3.5rem] shadow-2xl text-white`}>
                                    <h2 className="text-blue-400 font-black uppercase text-[10px] tracking-[0.5em] mb-8 border-b border-white/5 pb-4 text-center">Resumo de Envio</h2>
                                    {items.map((it, i) => (
                                        <div key={i} className="mb-8 last:mb-0 border-l-2 border-indigo-500/30 pl-5 space-y-2 text-sm">
                                            <p className="font-black text-base uppercase tracking-tighter">{i+1}. TAG: {it.equipamento || '---'}</p>
                                            <div className="flex flex-wrap gap-4 font-mono font-bold">
                                                <span className="text-limpos">‚úÖ {it.tubosLimpos || 0} L</span>
                                                <span className="text-obstruidos">‚ùå {it.tubosObstruidos || 0} O</span>
                                                <span className="text-ferro uppercase">‚ö†Ô∏è {it.tubosComFerro || 0} F</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="space-y-3 pb-10">
                                    <button onClick={handleSave} disabled={isSaving || syncStatus !== 'ONLINE'} className="w-full bg-blue-600 text-white py-6 rounded-[2.5rem] font-black uppercase text-[10px] flex items-center justify-center gap-3 active:scale-95 shadow-xl transition-all">{isSaving ? 'A Sincronizar...' : <><IconSave /> Enviar Dados para Nuvem</>}</button>
                                    <div className="flex gap-4">
                                        <button onClick={() => setView('form')} className={`flex-1 py-5 rounded-[2.5rem] font-black uppercase text-[9px] border transition-all ${theme === 'dark' ? 'bg-white/5 border-white/10 text-white' : 'bg-white border-slate-200 text-slate-500'}`}>Corrigir</button>
                                        <button onClick={handleWhatsApp} className="flex-[2] bg-green-500 text-white py-5 rounded-[2.5rem] font-black uppercase text-[9px] flex items-center justify-center gap-2 active:scale-95 tracking-widest shadow-xl shadow-green-500/20">WhatsApp</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {saveSuccess && (
                        <div className="success-overlay fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950/95">
                            <div className={`${cardClass} p-12 text-center shadow-2xl animate-in zoom-in duration-500`}>
                                <div className="bg-blue-600 text-white w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-8 animate-bounce shadow-[0_0_40px_rgba(37,99,235,0.5)]"><IconCheck /></div>
                                <h3 className="font-black uppercase text-2xl text-white">Sincronizado!</h3>
                                <p className="text-blue-400 text-[10px] font-bold mt-4 uppercase tracking-widest">Backup Cloud Conclu√≠do</p>
                            </div>
                        </div>
                    )}

                    <nav className={`fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-lg backdrop-blur-3xl border-t px-12 py-6 flex justify-around items-center z-40 rounded-t-[3rem] shadow-[0_-30px_60px_rgba(0,0,0,0.3)] transition-all duration-300 ${theme === 'dark' ? 'bg-slate-950/80 border-white/5' : 'bg-white/95 border-slate-200'}`}>
                        <button onClick={() => setView('form')} className={`flex flex-col items-center transition-all duration-500 ${view !== 'dashboard' ? 'text-blue-500 scale-125' : 'text-slate-500 opacity-40'}`}><IconClipboard /><span className="text-[8px] font-black uppercase mt-1.5 tracking-widest">Lan√ßar</span></button>
                        <button onClick={() => setView('dashboard')} className={`flex flex-col items-center transition-all duration-500 ${view === 'dashboard' ? 'text-blue-500 scale-125' : 'text-slate-500 opacity-40'}`}><IconChart /><span className="text-[8px] font-black uppercase mt-1.5 tracking-widest">Painel</span></button>
                    </nav>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
