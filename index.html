<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HidroControl - Gest√£o de Produtividade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        window.FirebaseSDK = { 
            initializeApp, 
            getFirestore, 
            collection, 
            addDoc, 
            serverTimestamp, 
            query, 
            orderBy, 
            limit, 
            onSnapshot, 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged,
            signInWithCustomToken
        };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .tag-dropdown { animation: slideDown 0.2s ease-out; }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .image-preview { object-fit: cover; width: 100%; height: 100%; border-radius: 1rem; }
        .progress-bar { transition: width 1s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // √çcones
        const IconClipboard = () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>;
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconCamera = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>;
        const IconSend = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;
        const IconSave = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const IconChart = () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>;

        const App = () => {
            const [view, setView] = useState('form'); 
            const [user, setUser] = useState(null);
            const [isSaving, setIsSaving] = useState(false);
            const [historyData, setHistoryData] = useState([]);
            const [saveSuccess, setSaveSuccess] = useState(false);
            const [activeDropdownIndex, setActiveDropdownIndex] = useState(null);
            
            // Estado principal: Informa√ß√µes Gerais + Lista de Equipamentos
            const [globalInfo, setGlobalInfo] = useState({
                data: new Date().toLocaleDateString('pt-BR'),
                empresa: 'Montisol',
                turno: 'ADM'
            });

            const initialItemState = {
                equipamento: '',
                atividade: 'Limpeza de tubos',
                tubosLimpos: '',
                tubosObstruidos: '',
                tubosComFerro: '',
                impactos: '',
                observacoes: '',
                fotosAntes: [], // Array de base64/URLs
                fotosDepois: []
            };

            const [items, setItems] = useState([initialItemState]);

            // Firebase Integration
            useEffect(() => {
                const initAuth = async () => {
                    if (!window.FirebaseSDK) return;
                    const { initializeApp, getFirestore, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } = window.FirebaseSDK;
                    try {
                        const firebaseConfigStr = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
                        if (!firebaseConfigStr) return;
                        const firebaseConfig = JSON.parse(firebaseConfigStr);
                        const app = initializeApp(firebaseConfig);
                        const auth = getAuth(app);
                        const db = getFirestore(app);
                        window.db = db;

                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                        onAuthStateChanged(auth, setUser);
                    } catch (e) { console.error("Auth Init Error:", e); }
                };
                initAuth();
            }, []);

            useEffect(() => {
                if (!user || !window.db) return;
                const { collection, query, orderBy, limit, onSnapshot } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'hidrocontrol-default';
                const q = query(collection(window.db, 'artifacts', appId, 'public', 'data', 'relatorios'), orderBy('createdAt', 'desc'), limit(50));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    setHistoryData(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                }, (err) => console.error("Firestore Sync Error:", err));
                return () => unsubscribe();
            }, [user]);

            const equipamentosLista = useMemo(() => [
                '025A-TC-21A','025A-TC-21B','025A-TC-21C','025A-TC-21D','025A-TC-21E','025A-TC-21F',
                '025A-TC-31A','025A-TC-31B','025A-TC-31C','025A-TC-31D','025A-TC-31E','025A-TC-31F',
                '030-TC-001','030-TC-002','030-TC-003','030-TC-004','030-TC-005','030-TC-006','030-TC-007','030-TC-008','030-TC-009','030-TC-010',
                '030-TC-22A','030-TC-22B','030-TC-22C','030-TC-22D','030-TC-23A','030-TC-23B','030-TC-24A','030-TC-24B',
                '040-TC-011','042-TC-011','042-TC-039'
            ], []);

            const addItem = () => setItems([...items, { ...initialItemState }]);
            const removeItem = (index) => {
                if (items.length > 1) {
                    const newItems = [...items];
                    newItems.splice(index, 1);
                    setItems(newItems);
                }
            };

            const updateItem = (index, field, value) => {
                const newItems = [...items];
                newItems[index][field] = value;
                setItems(newItems);
            };

            const handleFileChange = (e, index, type) => {
                const files = Array.from(e.target.files);
                const newPhotos = [];
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        newPhotos.push(reader.result);
                        if (newPhotos.length === files.length) {
                            const updatedItems = [...items];
                            updatedItems[index][type] = [...updatedItems[index][type], ...newPhotos];
                            setItems(updatedItems);
                        }
                    };
                    reader.readAsDataURL(file);
                });
            };

            const removePhoto = (itemIndex, type, photoIndex) => {
                const updatedItems = [...items];
                updatedItems[itemIndex][type].splice(photoIndex, 1);
                setItems(updatedItems);
            };

            const stats = useMemo(() => {
                // Simplifica√ß√£o do Dashboard para considerar a estrutura de itens
                let totalLimpos = 0;
                let totalFerro = 0;
                const turnosCount = { 'ADM': 0, 'T.C': 0, 'T.A': 0 };

                historyData.forEach(rel => {
                    const relItems = Array.isArray(rel.items) ? rel.items : [];
                    relItems.forEach(item => {
                        totalLimpos += (Number(item.tubosLimpos) || 0);
                        totalFerro += (Number(item.tubosComFerro) || 0);
                    });
                    turnosCount[rel.turno] = (turnosCount[rel.turno] || 0) + relItems.reduce((acc, i) => acc + (Number(i.tubosLimpos) || 0), 0);
                });
                return { totalLimpos, totalFerro, turnosCount };
            }, [historyData]);

            const handleSaveToCloud = async () => {
                setIsSaving(true);
                if (window.db && user) {
                    try {
                        const { collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                        const appId = typeof __app_id !== 'undefined' ? __app_id : 'hidrocontrol-default';
                        
                        await addDoc(collection(window.db, 'artifacts', appId, 'public', 'data', 'relatorios'), {
                            ...globalInfo,
                            items: items.map(it => ({
                                ...it,
                                tubosLimpos: Number(it.tubosLimpos) || 0,
                                tubosObstruidos: Number(it.tubosObstruidos) || 0,
                                tubosComFerro: Number(it.tubosComFerro) || 0,
                                fotosAntesCount: it.fotosAntes.length,
                                fotosDepoisCount: it.fotosDepois.length,
                                fotosAntes: [], // N√£o salvamos base64 no Firestore por limite de tamanho
                                fotosDepois: []
                            })),
                            userId: user.uid,
                            createdAt: serverTimestamp()
                        });
                        setSaveSuccess(true);
                    } catch (e) { console.error("Save Error:", e); }
                } else { setSaveSuccess(true); }
                setIsSaving(false);
            };

            const handleSendWhatsApp = () => {
                let msg = `*HIDROJATO - ${globalInfo.empresa.toUpperCase()}*%0A` +
                          `*Turno:* ${globalInfo.turno}%0A` +
                          `*Data:* ${globalInfo.data}%0A%0A`;

                items.forEach((item, idx) => {
                    msg += `*${idx + 1}. Equipamento:* ${item.equipamento}%0A` +
                           `‚úÖ Tubos Limpos: ${item.tubosLimpos}%0A` +
                           `${item.tubosObstruidos ? `‚ùå Obstru√≠dos: ${item.tubosObstruidos}%0A` : ''}` +
                           `${item.tubosComFerro ? `‚ö†Ô∏è Com Ferro: ${item.tubosComFerro}%0A` : ''}` +
                           `üì∏ Evid√™ncias: ${item.fotosAntes.length} Antes / ${item.fotosDepois.length} Depois%0A` +
                           `${item.impactos ? `‚ö° Impacto: ${item.impactos}%0A` : ''}` +
                           `${item.observacoes ? `üìù Obs: ${item.observacoes}%0A` : ''}%0A`;
                });

                msg += `_Relat√≥rio consolidado via HidroControl_`;
                window.open(`https://wa.me/?text=${msg}`, '_blank');
                resetForm();
            };

            const resetForm = () => {
                setItems([initialItemState]);
                setSaveSuccess(false);
                setView('form');
            };

            return (
                <div className="min-h-screen flex flex-col max-w-lg mx-auto bg-slate-50 shadow-2xl border-x border-slate-200">
                    <header className="bg-blue-800 text-white p-6 sticky top-0 z-40 shadow-xl flex items-center justify-between rounded-b-3xl">
                        <div className="flex items-center gap-3">
                            <IconClipboard />
                            <h1 className="font-black text-xl tracking-tight leading-none uppercase">Hidro<span className="text-blue-300">Control</span></h1>
                        </div>
                        <div className="bg-blue-900/40 px-3 py-1.5 rounded-xl border border-blue-500/50 text-[10px] font-black uppercase tracking-tighter">{globalInfo.data}</div>
                    </header>

                    <main className="flex-grow p-4 space-y-6 overflow-y-auto hide-scroll pb-28">
                        {view === 'dashboard' ? (
                            /* DASHBOARD VIEW */
                            <div className="animate-in fade-in duration-500 space-y-6">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 text-center">
                                        <p className="text-[10px] font-black uppercase text-slate-400 mb-1 tracking-widest">Produ√ß√£o Acumulada</p>
                                        <h4 className="text-3xl font-black text-blue-700">{stats.totalLimpos}</h4>
                                    </div>
                                    <div className="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 text-center">
                                        <p className="text-[10px] font-black uppercase text-red-400 mb-1 tracking-widest italic">Tubos c/ Ferro</p>
                                        <h4 className="text-3xl font-black text-red-600">{stats.totalFerro}</h4>
                                    </div>
                                </div>
                                <section className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100">
                                    <h3 className="text-[10px] font-black uppercase text-slate-500 mb-6 tracking-widest text-center">Produ√ß√£o por Turno</h3>
                                    <div className="space-y-5">
                                        {Object.entries(stats.turnosCount).map(([turno, count]) => {
                                            const percentage = stats.totalLimpos > 0 ? (count / stats.totalLimpos) * 100 : 0;
                                            return (
                                                <div key={turno} className="space-y-1">
                                                    <div className="flex justify-between text-[10px] font-black uppercase text-slate-400"><span>Turno {turno}</span><span>{count}</span></div>
                                                    <div className="h-3 bg-slate-50 rounded-full overflow-hidden border border-slate-100">
                                                        <div className="h-full bg-blue-600 progress-bar" style={{ width: `${percentage}%` }}></div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>
                            </div>
                        ) : view === 'form' ? (
                            /* FORM VIEW */
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-300 space-y-6">
                                {/* Informa√ß√µes Globais */}
                                <section className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3">
                                        {['Montisol', 'Constec'].map(e => (
                                            <button key={e} onClick={() => setGlobalInfo({...globalInfo, empresa: e})} className={`py-4 rounded-2xl font-black text-xs transition-all border ${globalInfo.empresa === e ? 'bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-200' : 'bg-white text-slate-500 border-slate-200'}`}>{e}</button>
                                        ))}
                                    </div>
                                    <div className="grid grid-cols-3 gap-3">
                                        {['ADM', 'T.C', 'T.A'].map(t => (
                                            <button key={t} onClick={() => setGlobalInfo({...globalInfo, turno: t})} className={`py-4 rounded-2xl font-black text-xs transition-all border ${globalInfo.turno === t ? 'bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-200' : 'bg-white text-slate-500 border-slate-200'}`}>{t}</button>
                                        ))}
                                    </div>
                                </section>

                                {/* Lista Din√¢mica de Equipamentos */}
                                <div className="space-y-8">
                                    {items.map((item, idx) => (
                                        <div key={idx} className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-6 relative animate-in zoom-in-95 duration-200">
                                            {items.length > 1 && (
                                                <button onClick={() => removeItem(idx)} className="absolute -top-3 -right-3 bg-red-500 text-white p-2 rounded-full shadow-lg"><IconTrash /></button>
                                            )}
                                            
                                            <div className="relative">
                                                <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block tracking-widest leading-none">Equipamento #{idx + 1}</label>
                                                <div className="relative">
                                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"><IconSearch /></div>
                                                    <input 
                                                        type="text" 
                                                        placeholder="Pesquisar TAG..." 
                                                        value={item.equipamento}
                                                        onFocus={() => setActiveDropdownIndex(idx)}
                                                        onChange={(e) => updateItem(idx, 'equipamento', e.target.value.toUpperCase())}
                                                        className="w-full pl-12 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-black text-sm"
                                                    />
                                                </div>
                                                {activeDropdownIndex === idx && (
                                                    <div className="absolute z-50 left-0 right-0 mt-2 bg-white border border-slate-200 rounded-2xl shadow-2xl max-h-48 overflow-y-auto tag-dropdown">
                                                        {equipamentosLista.filter(tag => tag.includes(item.equipamento)).map(tag => (
                                                            <div key={tag} onClick={() => { updateItem(idx, 'equipamento', tag); setActiveDropdownIndex(null); }} className="px-5 py-4 hover:bg-blue-50 border-b border-slate-50 last:border-none font-bold text-sm text-slate-700 flex justify-between items-center cursor-pointer">{tag}</div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>

                                            <div className="grid grid-cols-3 gap-3">
                                                <div className="space-y-1"><label className="text-[9px] font-black text-slate-400 block uppercase text-center tracking-tighter">Limpos</label><input type="number" value={item.tubosLimpos} onChange={(e) => updateItem(idx, 'tubosLimpos', e.target.value)} placeholder="0" className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-center font-black text-lg focus:ring-2 focus:ring-blue-500" /></div>
                                                <div className="space-y-1"><label className="text-[9px] font-black text-slate-400 block uppercase text-center tracking-tighter">Obstru√≠dos</label><input type="number" value={item.tubosObstruidos} onChange={(e) => updateItem(idx, 'tubosObstruidos', e.target.value)} placeholder="0" className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-center font-black text-lg focus:ring-2 focus:ring-blue-500" /></div>
                                                <div className="space-y-1"><label className="text-[9px] font-black text-red-500 block uppercase text-center tracking-tighter italic">C/ Ferro</label><input type="number" value={item.tubosComFerro} onChange={(e) => updateItem(idx, 'tubosComFerro', e.target.value)} placeholder="0" className="w-full p-4 bg-red-50 border border-red-100 rounded-2xl text-center font-black text-lg text-red-600 focus:ring-2 focus:ring-red-500" /></div>
                                            </div>

                                            {/* Galeria de Fotos */}
                                            <div className="space-y-4">
                                                <p className="text-[10px] font-black uppercase text-slate-400 text-center tracking-widest">Evid√™ncias do Equipamento</p>
                                                <div className="grid grid-cols-2 gap-3">
                                                    {/* Antes */}
                                                    <div className="space-y-2">
                                                        <input type="file" multiple accept="image/*" className="hidden" id={`antes-${idx}`} onChange={(e) => handleFileChange(e, idx, 'fotosAntes')} />
                                                        <label htmlFor={`antes-${idx}`} className="flex flex-col items-center justify-center p-4 bg-slate-50 border-2 border-dashed border-slate-200 rounded-3xl text-slate-400 cursor-pointer active:bg-slate-100 transition-all">
                                                            <IconCamera />
                                                            <span className="text-[9px] font-black uppercase mt-1">Fotos Antes</span>
                                                        </label>
                                                        <div className="grid grid-cols-2 gap-1 max-h-32 overflow-y-auto pr-1">
                                                            {item.fotosAntes.map((pic, pIdx) => (
                                                                <div key={pIdx} className="relative aspect-square">
                                                                    <img src={pic} className="image-preview w-full h-full" />
                                                                    <button onClick={() => removePhoto(idx, 'fotosAntes', pIdx)} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5"><IconX /></button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    {/* Depois */}
                                                    <div className="space-y-2">
                                                        <input type="file" multiple accept="image/*" className="hidden" id={`depois-${idx}`} onChange={(e) => handleFileChange(e, idx, 'fotosDepois')} />
                                                        <label htmlFor={`depois-${idx}`} className="flex flex-col items-center justify-center p-4 bg-slate-50 border-2 border-dashed border-slate-200 rounded-3xl text-slate-400 cursor-pointer active:bg-slate-100 transition-all">
                                                            <IconCamera />
                                                            <span className="text-[9px] font-black uppercase mt-1">Fotos Depois</span>
                                                        </label>
                                                        <div className="grid grid-cols-2 gap-1 max-h-32 overflow-y-auto pr-1">
                                                            {item.fotosDepois.map((pic, pIdx) => (
                                                                <div key={pIdx} className="relative aspect-square">
                                                                    <img src={pic} className="image-preview w-full h-full" />
                                                                    <button onClick={() => removePhoto(idx, 'fotosDepois', pIdx)} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5"><IconX /></button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-3">
                                                <textarea value={item.impactos} onChange={(e) => updateItem(idx, 'impactos', e.target.value)} placeholder="Impactos (Ex: atrasos, bloqueios)..." rows="2" className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-xs font-medium"></textarea>
                                                <textarea value={item.observacoes} onChange={(e) => updateItem(idx, 'observacoes', e.target.value)} placeholder="Observa√ß√µes adicionais..." rows="2" className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-xs font-medium"></textarea>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <button onClick={addItem} className="w-full py-5 rounded-[2.5rem] bg-white border-2 border-dashed border-blue-200 text-blue-600 font-black uppercase text-[10px] tracking-widest flex items-center justify-center gap-2 hover:bg-blue-50 transition-all">
                                    <IconPlus /> Adicionar Novo Equipamento
                                </button>

                                <button onClick={() => setView('preview')} disabled={items.some(i => !i.equipamento)} className="w-full bg-blue-800 text-white py-6 rounded-[2.5rem] font-black uppercase tracking-[0.2em] text-xs shadow-2xl shadow-blue-200 active:scale-95 transition-all mt-4 disabled:opacity-30">Revisar Relat√≥rio Consolidado</button>
                            </div>
                        ) : (
                            /* REVIS√ÉO & A√á√ïES */
                            <div className="animate-in fade-in zoom-in-95 duration-300 space-y-6 pt-2 text-sm">
                                <div className="bg-slate-900 p-8 rounded-[3.5rem] shadow-2xl border border-slate-800 space-y-6">
                                    <div className="flex justify-between items-start border-b border-slate-800 pb-4">
                                        <div className="space-y-1">
                                            <h2 className="text-blue-400 font-black uppercase text-[10px] tracking-widest leading-none">Resumo de Atividade</h2>
                                            <p className="text-slate-500 text-[10px] font-bold uppercase">{globalInfo.data} ‚Ä¢ Turno {globalInfo.turno}</p>
                                        </div>
                                        <span className="text-white font-black text-[9px] uppercase bg-blue-600 px-3 py-1 rounded-full">{globalInfo.empresa}</span>
                                    </div>
                                    
                                    <div className="space-y-6">
                                        {items.map((it, i) => (
                                            <div key={i} className="font-mono text-xs border-b border-slate-800/50 pb-4 last:border-none">
                                                <p className="text-blue-300 font-black mb-2 uppercase">{i+1}. {it.equipamento}</p>
                                                <div className="grid grid-cols-2 gap-y-1 pl-4">
                                                    <span className="text-slate-500">Limpos:</span> <span className="text-green-400 font-bold">{it.tubosLimpos}</span>
                                                    {it.tubosObstruidos > 0 && <><span className="text-slate-500">Obstru√≠dos:</span> <span className="text-red-400 font-bold">{it.tubosObstruidos}</span></>}
                                                    {it.tubosComFerro > 0 && <><span className="text-slate-500">Com Ferro:</span> <span className="text-yellow-400 font-bold italic">{it.tubosComFerro}</span></>}
                                                    <span className="text-slate-500">Fotos:</span> <span className="text-slate-300 italic">{it.fotosAntes.length}A / {it.fotosDepois.length}D</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {saveSuccess ? (
                                    <div className="bg-green-50 border border-green-200 p-6 rounded-[2.5rem] text-center space-y-4 animate-bounce">
                                        <p className="text-green-800 font-black uppercase text-xs tracking-widest">‚úÖ Registro Consolidado com Sucesso!</p>
                                        <div className="flex gap-3">
                                            <button onClick={handleSendWhatsApp} className="flex-1 bg-green-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] flex items-center justify-center gap-2"><IconSend /> Enviar WhatsApp</button>
                                            <button onClick={resetForm} className="flex-1 bg-slate-800 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Novo Relat√≥rio</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex flex-col gap-3">
                                        <button onClick={handleSaveToCloud} disabled={isSaving} className="w-full bg-blue-700 text-white py-6 rounded-[2.5rem] font-black uppercase tracking-widest text-xs shadow-xl flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50">
                                            {isSaving ? 'Processando...' : <><IconSave /> Registrar Tudo na Cloud</>}
                                        </button>
                                        <div className="flex gap-4">
                                            <button onClick={() => setView('form')} className="flex-1 bg-white py-5 rounded-[2.5rem] font-black uppercase text-[10px] border border-slate-200 text-slate-400">Editar</button>
                                            <button onClick={handleSendWhatsApp} className="flex-[2] bg-green-500 text-white py-5 rounded-[2.5rem] font-black uppercase text-[10px] flex items-center justify-center gap-2 shadow-lg shadow-green-100"><IconSend /> Enviar WhatsApp</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-lg bg-white/90 backdrop-blur-xl border-t border-slate-100 px-10 py-5 flex justify-around items-center z-40 rounded-t-[2.5rem] shadow-[0_-10px_30px_rgba(0,0,0,0.03)]">
                        <button onClick={() => setView('form')} className={`flex flex-col items-center transition-all ${view === 'form' || view === 'preview' ? 'text-blue-800 scale-110' : 'text-slate-300'}`}>
                            <IconClipboard />
                            <span className="text-[8px] font-black uppercase mt-1 tracking-tighter">Relat√≥rio</span>
                        </button>
                        <div className="relative -mt-12">
                            <div className="w-14 h-14 rounded-full bg-blue-800 text-white flex items-center justify-center border-4 border-slate-50 shadow-xl shadow-blue-200 active:scale-90 transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                            </div>
                        </div>
                        <button onClick={() => setView('dashboard')} className={`flex flex-col items-center transition-all ${view === 'dashboard' ? 'text-blue-800 scale-110' : 'text-slate-300'}`}>
                            <IconChart />
                            <span className="text-[8px] font-black uppercase mt-1 tracking-tighter font-bold">Dashboard</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
