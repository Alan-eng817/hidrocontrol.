<!DOCTYPE html>
<html lang="pt-BR" class="notranslate">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HidroControl - Gestão Industrial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDKs - MANTENHA SEMPRE EM INGLÊS (NÃO TRADUZIR) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, onSnapshot, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        window.FB_CORE = { initializeApp, getFirestore, collection, addDoc, serverTimestamp, query, onSnapshot, getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, doc, getDoc };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease; background-color: #020617; color: white; }
        .glass-dark { background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); }
        .animate-pop { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ✅ CONFIGURAÇÃO FIREBASE ALAN (hidrocontrol-4c13c)
        const CONFIG_MANUAL_FIREBASE = {
            // ⚠️ ALAN: COLA AQUI A CHAVE COMPLETA QUE COPIASTE DO FIREBASE (SEM OS "XXX").
            // Ela deve ter cerca de 39 caracteres. Se tiver apenas 35, está errada.
            apiKey: "AIzaSyCRxv_1e-QXC_vCXM5XHx65Zi_1PWQAw", 
            authDomain: "hidrocontrol-4c13c.firebaseapp.com",
            projectId: "hidrocontrol-4c13c",
            storageBucket: "hidrocontrol-4c13c.firebasestorage.app",
            messagingSenderId: "260764839228",
            appId: "1:260764839228:web:340ab3fe2ea7675030c239"
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [auth, setAuth] = useState(null);
            const [db, setDb] = useState(null);
            const [loginData, setLoginData] = useState({ email: '', password: '' });
            const [errorMessage, setErrorMessage] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const init = async () => {
                    let count = 0;
                    while (!window.FB_CORE && count < 50) {
                        await new Promise(r => setTimeout(r, 100));
                        count++;
                    }
                    if (!window.FB_CORE) return;
                    try {
                        const app = window.FB_CORE.initializeApp(CONFIG_MANUAL_FIREBASE);
                        const authInst = window.FB_CORE.getAuth(app);
                        setAuth(authInst);
                        setDb(window.FB_CORE.getFirestore(app));
                        window.FB_CORE.onAuthStateChanged(authInst, (u) => { 
                            setUser(u); 
                            if (u) setErrorMessage(null);
                        });
                    } catch (e) { 
                        setErrorMessage("ERRO DE CONFIGURAÇÃO: Chave Inválida."); 
                    }
                };
                init();
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setErrorMessage(null);
                setLoading(true);
                try {
                    await window.FB_CORE.signInWithEmailAndPassword(auth, loginData.email, loginData.password);
                } catch (err) {
                    if (err.code === 'auth/api-key-not-valid') {
                        setErrorMessage("A CHAVE API NO CÓDIGO ESTÁ ERRADA. PEGA A CHAVE COMPLETA NO FIREBASE.");
                    } else if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password') {
                        setErrorMessage("E-mail ou Senha incorretos.");
                    } else {
                        setErrorMessage("Erro: " + err.code);
                    }
                } finally {
                    setLoading(false);
                }
            };

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-slate-950">
                        <div className="glass-dark w-full max-w-sm p-10 rounded-[3.5rem] shadow-2xl text-center space-y-6 animate-pop">
                            <h1 className="font-black text-2xl tracking-tighter uppercase">HIDRO<span className="text-blue-400">CONTROL</span></h1>
                            {errorMessage && (
                                <div className="bg-red-500/20 p-4 rounded-2xl text-[10px] text-red-400 font-bold border border-red-500/30 uppercase leading-tight">
                                    {errorMessage}
                                </div>
                            )}
                            <form onSubmit={handleLogin} className="space-y-4 text-left">
                                <input 
                                    type="email" 
                                    placeholder="E-mail" 
                                    value={loginData.email} 
                                    onChange={e => setLoginData({...loginData, email: e.target.value})} 
                                    className="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800 outline-none font-bold text-sm text-white" 
                                    required 
                                />
                                <input 
                                    type="password" 
                                    placeholder="Senha" 
                                    value={loginData.password} 
                                    onChange={e => setLoginData({...loginData, password: e.target.value})} 
                                    className="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800 outline-none font-bold text-sm text-white" 
                                    required 
                                />
                                <button 
                                    type="submit" 
                                    disabled={loading}
                                    className="w-full bg-blue-600 py-4 rounded-2xl font-black uppercase text-xs shadow-xl active:scale-95 transition-all text-white"
                                >
                                    {loading ? 'Entrando...' : 'Entrar'}
                                </button>
                            </form>
                            <p className="text-[9px] text-slate-500 font-bold uppercase">Utilizador adicionado com sucesso!</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-10 bg-slate-950">
                    <div className="glass-dark p-10 rounded-[3rem] text-center space-y-4 animate-pop">
                        <h2 className="text-green-500 font-black text-2xl uppercase tracking-tighter text-white">SISTEMA LIGADO!</h2>
                        <p className="text-sm text-slate-300">Olá, {user.email}. O acesso foi validado.</p>
                        <button 
                            onClick={() => window.FB_CORE.signOut(auth)} 
                            className="bg-red-500/20 text-red-400 py-2 px-6 rounded-xl font-black uppercase text-[10px] border border-red-500/30"
                        >
                            Sair
                        </button>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
